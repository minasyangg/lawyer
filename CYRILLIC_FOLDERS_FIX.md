# Исправление кириллических названий папок

## Проблема

Supabase Storage не поддерживает кириллические символы в путях к файлам. Это приводит к ошибкам вида:

```
Error [StorageApiError]: Invalid key: user_1/сцуа/start/1758231908630_122eqhfseap.png
```

## Решение

Мы обновили систему валидации, чтобы предотвратить создание новых папок с кириллическими символами. Теперь названия папок автоматически транслитерируются в латиницу.

### Автоматическая транслитерация

- ✅ **Новые папки**: Автоматически транслитерируются при создании
- ✅ **Переименование**: Показывает предупреждение о транслитерации
- ✅ **Валидация**: Zod схема с поддержкой транслитерации

### Исправление существующих папок

Для исправления папок, которые уже существуют с кириллическими символами:

1. **Запустите скрипт исправления:**
   ```bash
   npm run fix-cyrillic
   ```

2. **Скрипт покажет:**
   - Список папок с кириллическими символами
   - Предложенные новые названия
   - Запрос подтверждения

3. **После подтверждения:**
   - Обновляются названия в базе данных
   - Показывается список изменений

4. **Важно:** После запуска скрипта нужно также переименовать папки в Supabase Storage через файловый менеджер.

### Примеры транслитерации

- `сцуа` → `stsua`
- `Папка документов` → `papka_dokumentov`
- `Фото 2024` → `foto_2024`
- `Тест/файлы` → `test_fayly`

### Новые правила валидации

1. **Разрешенные символы:** латинские буквы, цифры, `-`, `_`
2. **Автоматическая обработка:** кириллица → латиница
3. **Безопасность:** удаление специальных символов
4. **Уникальность:** добавление счетчика при конфликтах

### Предупреждения в UI

Модальное окно переименования теперь показывает:
- ⚠️ **Предупреждение:** когда название будет изменено
- ❌ **Ошибка:** если название некорректно
- ✅ **Успех:** если название безопасно

## Файлы системы

- `src/lib/validations/folder.ts` - Zod схемы с транслитерацией
- `src/lib/utils/folder-validation.ts` - Функции валидации и транслитерации
- `src/components/admin/RenameFolderModal.tsx` - UI с предупреждениями
- `scripts/fix-cyrillic-folders.ts` - Скрипт исправления