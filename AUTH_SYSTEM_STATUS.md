# üìä –°—Ç–∞—Ç—É—Å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

## ‚úÖ –ß—Ç–æ –≥–æ—Ç–æ–≤–æ –∫ –∑–∞–ø—É—Å–∫—É

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **Prisma —Å—Ö–µ–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞** —Å –Ω–æ–≤—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏:
  - `UserRole` enum (ADMIN, EDITOR, USER)
  - `UserStatus` enum (PENDING, APPROVED, REJECTED, ACTIVE, SUSPENDED)
  - `LoginAttemptResult` enum
  - –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å `User` —Å 2FA –ø–æ–ª—è–º–∏
  - –ú–æ–¥–µ–ª—å `LoginLog` –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

### 2. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- ‚úÖ **–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø–∞–∫–µ—Ç—ã**: speakeasy, qrcode, jsonwebtoken, bcryptjs, nodemailer
- ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–∏–ø—ã** –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ .env.local:
  - JWT –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  - Email –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  - Rate limiting –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

### 4. –°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
- ‚úÖ **RBAC —Å–∏—Å—Ç–µ–º–∞** (`src/lib/auth/permissions.ts`):
  - –î–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π —Ä–æ–ª–∏
  - –§—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
  - –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è —Å—Ç–∞—Ç–µ–π –∏ —Ñ–∞–π–ª–æ–≤

### 5. –î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- ‚úÖ **TOTP —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è** (`src/lib/auth/totp.ts`):
  - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤ –∏ QR –∫–æ–¥–æ–≤
  - –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤ Google Authenticator
  - –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–¥—ã (backup codes)
  - –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 6. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π seed —Ñ–∞–π–ª** (`prisma/seeds/seed.js`):
  - –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∞ —Å –±–µ–∑–æ–ø–∞—Å–Ω—ã–º –ø–∞—Ä–æ–ª–µ–º
  - –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
  - –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üîÑ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ (–ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –ü–ö)

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—É—é –ë–î (PostgreSQL Docker)

# 2. –°–æ–∑–¥–∞—Ç—å –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
npm run db:migrate
# –ò–º—è –º–∏–≥—Ä–∞—Ü–∏–∏: enhanced_auth_system

# 3. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ë–î –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
npm run db:fresh

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
npm run dev
```

## üîê –î–∞–Ω–Ω—ã–µ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞

**–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä:**
- Email: `admin@lawyer-site.com`
- –ü–∞—Ä–æ–ª—å: `AdminPass123!`
- üîí **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞!**
- üì± **2FA –±—É–¥–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**

## üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –ì–æ—Ç–æ–≤–æ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
1. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ middleware** - –∞–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É —Ä–æ–ª–µ–π
2. **–ù–æ–≤—ã–µ auth actions** - –∑–∞–º–µ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏  
3. **JWT —Ç–æ–∫–µ–Ω—ã** - –∑–∞–º–µ–Ω–∞ –ø—Ä–æ—Å—Ç—ã—Ö cookie —Å–µ—Å—Å–∏–π
4. **Rate limiting** - –∑–∞—â–∏—Ç–∞ –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞
5. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ö–æ–¥–æ–≤** - –∑–∞–ø–∏—Å—å –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

### –ü–æ—Ç—Ä–µ–±—É–µ—Ç UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:
1. **2FA –Ω–∞—Å—Ç—Ä–æ–π–∫–∞** - QR –∫–æ–¥ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
2. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å –º–æ–¥–µ—Ä–∞—Ü–∏–µ–π** - —Ñ–æ—Ä–º–∞ –∑–∞—è–≤–∫–∏
3. **–ê–¥–º–∏–Ω—Å–∫–∞—è –ø–∞–Ω–µ–ª—å** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
4. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è** - —Ñ–æ—Ä–º—ã –∏ email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

## üéØ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- **JWT —Ç–æ–∫–µ–Ω—ã** –≤–º–µ—Å—Ç–æ –ø—Ä–æ—Å—Ç—ã—Ö cookies
- **Rate limiting** –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –∞—Ç–∞–∫
- **2FA –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞** –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞
- **–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π** —Å bcrypt (rounds: 12)

### –†–æ–ª–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞:
- **ADMIN**: –ü–æ–ª–Ω—ã–µ –ø—Ä–∞–≤–∞ (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∞–π—Ç–∞, –≤—Å–µ —Å—Ç–∞—Ç—å–∏)
- **EDITOR**: –°–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–≤–æ–∏—Ö —Å—Ç–∞—Ç–µ–π, –ø—Ä–æ—Å–º–æ—Ç—Ä —á—É–∂–∏—Ö, —Ñ–∞–π–ª–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä
- **USER**: –¢–æ–ª—å–∫–æ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

### –ú–æ–¥–µ—Ä–∞—Ü–∏—è:
- **–ü—É–±–ª–∏—á–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** ‚Üí —Å—Ç–∞—Ç—É—Å PENDING ‚Üí –º–æ–¥–µ—Ä–∞—Ü–∏—è –∞–¥–º–∏–Ω–æ–º
- **–ü—Ä—è–º–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ** –∞–¥–º–∏–Ω–æ–º ‚Üí —Å—Ä–∞–∑—É —Å—Ç–∞—Ç—É—Å ACTIVE
- **–°–∏—Å—Ç–µ–º–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π** —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø—Ä–∏—á–∏–Ω—ã

## üö® –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏

1. **–ú–∏–≥—Ä–∞—Ü–∏—è –Ω–µ–æ–±—Ä–∞—Ç–∏–º–∞** - —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î
2. **–°—Ç–∞—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —É–¥–∞–ª—è—é—Ç—Å—è** - –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω
3. **2FA –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞** - –Ω–µ–ª—å–∑—è –æ—Ç–∫–ª—é—á–∏—Ç—å –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
4. **Email –æ–ø—Ü–∏–æ–Ω–∞–ª–µ–Ω** - –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞, –Ω–æ SMTP –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω

---

**–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ**: 15 —Å–µ–Ω—Ç—è–±—Ä—è 2025  
**–ì–æ—Ç–æ–≤–æ –∫ –∑–∞–ø—É—Å–∫—É**: –ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –ü–ö –∏ —Å—Ç–∞—Ä—Ç–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã