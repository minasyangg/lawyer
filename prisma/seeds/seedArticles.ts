import { PrismaClient } from '@prisma/client';
import bcrypt from 'bcryptjs';

const prisma = new PrismaClient();

async function main() {
  // Create admin user with password if not exists
  const adminUser = await prisma.user.upsert({
    where: { email: 'admin@example.com' },
    update: {},
    create: {
      name: 'Admin User',
      email: 'admin@example.com',
      password: await bcrypt.hash('admin123', 10),
      userRole: 'ADMIN'
    }
  });

  // Get services for categorization
  const services = await prisma.service.findMany();
  
  if (services.length === 0) {
    console.log('No services found. Please run services seed first.');
    return;
  }

  const articles = [
    {
      title: "Новые изменения в налоговом законодательстве 2024",
      slug: "novye-izmeneniya-v-nalogovom-zakonodatelstve-2024",
      content: `В 2024 году в российское налоговое законодательство внесен ряд важных изменений, которые затрагивают как предпринимателей, так и обычных граждан.

Основные изменения:

1. Изменения в НДС
Установлены новые требования к электронным счетам-фактурам. Теперь все операции с НДС должны проводиться через единую систему электронного документооборота.

2. Налог на прибыль
Изменен порядок признания доходов и расходов для некоторых видов деятельности. Особое внимание уделяется IT-деятельности и экспортным операциям.

3. Подоходный налог
Введены новые льготы для семей с детьми и изменен порядок расчета налогового вычета на недвижимость.

Рекомендации:
- Проконсультируйтесь со специалистами для адаптации вашего бизнеса
- Обновите учетные системы в соответствии с новыми требованиями
- Рассмотрите возможности оптимизации налогообложения

Наша компания готова помочь вам в адаптации к новым требованиям и оптимизации налоговых обязательств.`,
      excerpt: "Обзор ключевых изменений в налоговом законодательстве России на 2024 год и их влияние на бизнес.",
      published: true,
      categoryId: services.find(s => s.title.includes('налог'))?.id || services[0].id,
      authorId: adminUser.id
    },
    {
      title: "Процедура банкротства физических лиц: пошаговое руководство",
      slug: "procedura-bankrotstva-fizicheskih-lic-poshagovoe-rukovodstvo",
      content: `Банкротство физических лиц — это законная процедура, позволяющая гражданам освободиться от долговых обязательств при невозможности их исполнения.

Условия для подачи на банкротство:
1. Сумма долга превышает 500 000 рублей
2. Просрочка платежей составляет более 3 месяцев
3. Невозможность погашения долгов подтверждена документально

Этапы процедуры:

1. Подготовка документов
- Справки о доходах за 3 года
- Выписки по банковским счетам
- Документы о собственности
- Справки о задолженностях

2. Подача заявления в суд
Подается в арбитражный суд по месту регистрации должника.

3. Рассмотрение дела
Суд назначает финансового управляющего и определяет процедуру.

4. Реструктуризация или реализация имущества
В зависимости от ситуации применяется одна из процедур.

Последствия банкротства:
- Списание долгов (кроме алиментов и возмещения вреда)
- Ограничения на получение кредитов
- Невозможность повторной подачи на банкротство в течение 5 лет

Важно: процедура банкротства требует профессионального сопровождения. Обратитесь к специалистам для получения квалифицированной помощи.`,
      excerpt: "Подробное руководство по процедуре банкротства физических лиц: условия, этапы и последствия.",
      published: true,
      categoryId: services.find(s => s.title.includes('банкротств'))?.id || services[0].id,
      authorId: adminUser.id
    },
    {
      title: "Защита интеллектуальной собственности в цифровую эпоху",
      slug: "zaschita-intellectualnoy-sobstvennosti-v-cifrovuyu-epohu",
      content: `В современном мире цифровых технологий защита интеллектуальной собственности становится все более актуальной задачей для бизнеса и творческих работников.

Виды интеллектуальной собственности:

1. Авторские права
- Литературные и художественные произведения
- Программы для ЭВМ
- Базы данных

2. Смежные права
- Права исполнителей
- Права производителей фонограмм
- Права организаций эфирного вещания

3. Промышленная собственность
- Изобретения и полезные модели
- Товарные знаки
- Промышленные образцы

Основные угрозы в цифровой среде:

1. Незаконное копирование и распространение
2. Нарушение авторских прав в интернете
3. Кибер-пиратство
4. Незаконное использование товарных знаков

Способы защиты:

1. Правовые механизмы
- Регистрация прав
- Лицензирование
- Договоры о неразглашении

2. Технические средства
- DRM-системы
- Цифровые подписи
- Блокчейн-технологии

3. Мониторинг и принуждение
- Отслеживание нарушений
- Досудебное урегулирование
- Судебная защита

Рекомендации:
- Своевременно регистрируйте права на объекты интеллектуальной собственности
- Используйте технические средства защиты
- Регулярно мониторьте использование ваших объектов в сети
- При обнаружении нарушений незамедлительно обращайтесь к специалистам`,
      excerpt: "Современные подходы к защите интеллектуальной собственности в условиях цифровизации и интернет-технологий.",
      published: true,
      categoryId: services.find(s => s.title.includes('интеллектуальн'))?.id || services[0].id,
      authorId: adminUser.id
    },
    {
      title: "Корпоративные споры: как защитить интересы бизнеса",
      slug: "korporativnye-spory-kak-zaschitit-interesy-biznesa",
      content: `Корпоративные споры — неотъемлемая часть ведения бизнеса. Эффективное их разрешение критически важно для сохранения и развития компании.

Типичные корпоративные споры:

1. Споры между участниками
- Разногласия по стратегии развития
- Конфликты при распределении прибыли
- Споры о выходе из общества

2. Споры с менеджментом
- Нарушение обязанностей директора
- Конфликт интересов
- Злоупотребления полномочиями

3. Споры с третьими лицами
- Оспаривание сделок
- Привлечение к субсидиарной ответственности
- Требования кредиторов

Методы предотвращения споров:

1. Качественные документы
- Четкий устав
- Детальные договоры
- Прозрачные внутренние процедуры

2. Корпоративное управление
- Регулярные собрания участников
- Эффективный совет директоров
- Система внутреннего контроля

3. Профилактическая работа
- Регулярный аудит рисков
- Обучение персонала
- Консультации со специалистами

Способы разрешения споров:

1. Переговоры
Самый быстрый и экономичный способ решения конфликтов.

2. Медиация
Привлечение независимого посредника для достижения соглашения.

3. Арбитраж
Рассмотрение спора в арбитражном суде с вынесением обязательного решения.

4. Специальные процедуры
- Выкуп долей
- Ликвидация общества
- Реорганизация

Стратегия защиты:
- Оперативное реагирование на возникающие проблемы
- Сбор и сохранение доказательств
- Профессиональное правовое сопровождение
- Оценка рисков и выбор оптимальной стратегии

Помните: раннее обращение к специалистам значительно увеличивает шансы на успешное разрешение корпоративного спора.`,
      excerpt: "Руководство по предотвращению и разрешению корпоративных споров с защитой интересов бизнеса.",
      published: true,
      categoryId: services.find(s => s.title.includes('спор'))?.id || services[0].id,
      authorId: adminUser.id
    },
    {
      title: "Комплексное юридическое сопровождение стартапов",
      slug: "kompleksnoe-yuridicheskoe-soprovozhdenie-startapov",
      content: `Стартапы сталкиваются с множеством юридических вызовов на пути к успеху. Правильное правовое сопровождение с самого начала — залог устойчивого развития бизнеса.

Ключевые юридические аспекты для стартапов:

1. Выбор организационно-правовой формы
- ИП или ООО: сравнительный анализ
- Особенности налогообложения
- Ограничения и возможности роста

2. Защита интеллектуальной собственности
- Регистрация товарных знаков
- Патентование изобретений
- Защита коммерческих тайн

3. Инвестиционные сделки
- Структурирование привлечения инвестиций
- Due diligence процедуры
- Соглашения с инвесторами

4. Трудовые отношения
- Оформление ключевого персонала
- Опционные программы
- Соглашения о неконкуренции

Этапы юридического сопровождения:

1. Стадия идеи и MVP
- Регистрация бизнеса
- Первичная защита IP
- Базовые договоры

2. Привлечение первых инвестиций
- Подготовка к due diligence
- Переговоры с инвесторами
- Структурирование сделки

3. Масштабирование
- Корпоративные процедуры
- Международная экспансия
- Подготовка к следующим раундам

4. Выход (Exit)
- IPO подготовка
- M&A сделки
- Структурирование продажи

Распространенные ошибки стартапов:

1. Игнорирование правовых аспектов на раннем этапе
2. Неправильное распределение долей между основателями
3. Отсутствие защиты интеллектуальной собственности
4. Неподготовленность к инвестиционным переговорам

Рекомендации:
- Обращайтесь к юристам с первых шагов развития стартапа
- Документируйте все важные решения и соглашения
- Регулярно обновляйте правовую структуру по мере роста
- Инвестируйте в качественное корпоративное управление

Профессиональное юридическое сопровождение — это не расходы, а инвестиции в будущее успешного бизнеса.`,
      excerpt: "Полное руководство по юридическому сопровождению стартапов на всех этапах развития бизнеса.",
      published: false, // Draft article
      categoryId: services.find(s => s.title.includes('сопровожден'))?.id || services[0].id,
      authorId: adminUser.id
    }
  ];

  let created = 0
  let updated = 0
  for (const articleData of articles) {
    const upserted = await prisma.article.upsert({
      where: { slug: articleData.slug },
      update: {
        title: articleData.title,
        excerpt: articleData.excerpt,
        content: articleData.content,
        published: articleData.published,
        categoryId: articleData.categoryId,
        authorId: articleData.authorId,
      },
      create: articleData,
    })
    if (upserted.createdAt.getTime() === upserted.updatedAt.getTime()) created++
    else updated++
  }

  console.log(`Articles seeded successfully (created: ${created}, updated: ${updated})`);
}

main()
  .catch((e) => {
    console.error(e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });