# Database Provider System (Simplified)

–£–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–∞–∑–Ω—ã–º–∏ –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ä–µ–¥—ã.

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–ü—Ä–æ—Å—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–±–æ—Ä–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∏ Supabase –º–∏–≥—Ä–∞—Ü–∏–π.

## üîß –°—Ä–µ–¥—ã

### Local (—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)
- **–§–∞–π–ª**: `.env.local`
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL –≤ Docker
- **–ö–æ–º–∞–Ω–¥—ã**: –æ–±—ã—á–Ω—ã–µ Prisma –∫–æ–º–∞–Ω–¥—ã

### Production (Supabase)
- **–§–∞–π–ª**: `.env.production`  
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: Supabase PostgreSQL
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å**: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è DIRECT_URL –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π (–æ–±—Ö–æ–¥ pgbouncer)

## üöÄ –ö–æ–º–∞–Ω–¥—ã

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
```bash
npm run db:migrate          # prisma migrate dev
npm run db:seed             # seed –¥–∞–Ω–Ω—ã–µ
npm run db:studio           # Prisma Studio
npm run db:reset            # —Å–±—Ä–æ—Å –ë–î
npm run db:fresh            # reset + seed
```

### –ü—Ä–æ–¥–∞–∫—à–Ω (Supabase)
```bash
npm run db:migrate:prod     # migrate deploy —Å DIRECT_URL
npm run db:deploy:prod      # —Ç–æ –∂–µ —á—Ç–æ migrate:prod
npm run db:seed:prod        # seed –≤ Supabase
npm run db:studio:prod      # Studio –¥–ª—è Supabase
npm run db:fresh:prod       # reset + seed –≤ Supabase
```

## üîß –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–æ—Å—Ç–æ–π runner —Å–∫—Ä–∏–ø—Ç
–§–∞–π–ª `scripts/prisma-runner.js` –≤—ã–ø–æ–ª–Ω—è–µ—Ç:

1. **–ó–∞–≥—Ä—É–∂–∞–µ—Ç –Ω—É–∂–Ω—ã–π .env —Ñ–∞–π–ª** (.env.local –∏–ª–∏ .env.production)
2. **–î–ª—è Supabase –º–∏–≥—Ä–∞—Ü–∏–π** –∑–∞–º–µ–Ω—è–µ—Ç DATABASE_URL –Ω–∞ DIRECT_URL
3. **–ó–∞–ø—É—Å–∫–∞–µ—Ç –æ–±—ã—á–Ω—É—é Prisma –∫–æ–º–∞–Ω–¥—É** —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏

### –ö–ª—é—á–µ–≤–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å –¥–ª—è Supabase
```javascript
// –î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω –º–∏–≥—Ä–∞—Ü–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º DIRECT_URL
if (isProd && command === 'migrate') {
  process.env.DATABASE_URL = envVars.DIRECT_URL; // –û–±—Ö–æ–¥ pgbouncer!
}
```

## üõ† –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### .env.local
```bash
DATABASE_URL="postgresql://postgres:1234@localhost:5432/mydb?schema=public"
DIRECT_URL="postgresql://postgres:1234@localhost:5432/mydb?schema=public"
```

### .env.production  
```bash
# –û–±—ã—á–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ connection pooling
DATABASE_URL="postgresql://postgres.xxx:[PASSWORD]@aws-xxx.pooler.supabase.com:6543/postgres?pgbouncer=true"

# –ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π (–ë–ï–ó pgbouncer!)
DIRECT_URL="postgresql://postgres.xxx:[PASSWORD]@aws-xxx.pooler.supabase.com:5432/postgres"
```

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —É–ø—Ä–æ—â–µ–Ω–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è

1. **–û–¥–∏–Ω —Ñ–∞–π–ª** –≤–º–µ—Å—Ç–æ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ .mjs —Ñ–∞–π–ª–æ–≤
2. **–ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞** - –ª–µ–≥–∫–æ –ø–æ–Ω—è—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å  
3. **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ Supabase** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ DIRECT_URL
4. **–ó–Ω–∞–∫–æ–º—ã–µ –∫–æ–º–∞–Ω–¥—ã** - –æ–±—ã—á–Ω—ã–µ npm run –∫–æ–º–∞–Ω–¥—ã
5. **–ú–∏–Ω–∏–º—É–º –∫–æ–¥–∞** - —Ä–µ—à–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É –±–µ–∑ –∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏

## üö® –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Å—Ç–∞—Ç–µ–π

–ü—Ä–æ–±–ª–µ–º–∞ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –±—ã–ª–∞ —Å–≤—è–∑–∞–Ω–∞ —Å —Ç–µ–º, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–ª–∏—Å—å –∫ Supabase –ë–î.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
npm run db:migrate:prod
```

–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∫ Supabase –∏—Å–ø–æ–ª—å–∑—É—è DIRECT_URL.
